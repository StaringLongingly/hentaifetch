#!/bin/sh

tmpfile="$(mktemp)"

# echo "$2" | grep -qE '^[0-9]+$' && height="$2" || height="$(($(stty size | awk '{print $1}') - 5))"
# [ "$DEBUG" = "true" ] && echo "Using height $height"

random=$(curl -sl "https://wholesomelist.com/random")
id=$(echo $random | grep -oP '(?<=list\/)\S+')

nurl=$(curl -fsSL "https://wholesomelist.com/list/$id" | grep -m1 -o "https://nhentai\.net/g/[[:digit:]]*")
tag=$(echo "$nurl" | grep -o "[[:digit:]]*")

url=$(echo https://wholesomelist.com/asset/$id.jpg)

curl -fsSLo "$tmpfile" "$url"

if [ "$TERM" = "xterm-kitty" ]; then
    command -v convert > /dev/null 2>&1 && neofetch --kitty "$tmpfile" || kitty_imagemagick_warn=true
    if [ "$kitty_imagemagick_warn" = "true" ]; then
        neofetch --caca "$tmpfile"
    fi
else
    neofetch --caca "$tmpfile"
fi
printf "NHentai tag: #$tag\n"

rm "$tmpfile"

[ "$kitty_imagemagick_warn" = "true" ] && echo "WARN: imagemagick is required for kitty image backend"
